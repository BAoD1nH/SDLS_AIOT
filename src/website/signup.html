<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - MyLock</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    <script type="module">
        // Import at top level
        import { auth, db, storage } from './js/firebase.js';
        console.log('firebase.js imported successfully');

        // Initialize Firebase
        try {
            console.log('Loading firebase.js module');
            if (!firebase.apps.length) {
                throw new Error('Firebase app not initialized in firebase.js');
            }
            window.firebase = { 
                auth: () => auth,
                firestore: () => db,
                storage: () => storage
            };
            console.log('Firebase initialized successfully');
            window.dispatchEvent(new Event('firebaseInitialized'));
        } catch (error) {
            console.error('Firebase module initialization failed:', error);
            const errorDiv = document.getElementById('error-message');
            if (errorDiv) {
                errorDiv.textContent = 'Lỗi khởi tạo Firebase: ' + error.message;
                errorDiv.classList.remove('hidden');
            }
        }
    </script>
    <script defer src="js/auth.js"></script>
    <script>
        // Function to enable signup button
        function enableSignupButton() {
            const signupButton = document.querySelector('button[onclick="signUp()"]');
            if (signupButton) {
                signupButton.disabled = false;
                console.log('Signup button enabled');
            }
        }

        // Function to handle initialization failure
        function handleInitializationFailure(message) {
            const errorDiv = document.getElementById('error-message');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.remove('hidden');
            }
            console.error(message);
        }

        // Wait for Firebase initialization
        document.addEventListener('firebaseInitialized', () => {
            if (window.firebase && window.firebase.auth) {
                enableSignupButton();
            } else {
                handleInitializationFailure('Lỗi: Firebase chưa được khởi tạo.');
            }
        });

        // Fallback in case firebaseInitialized event is missed
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMContentLoaded fired');
            setTimeout(() => {
                if (window.firebase && window.firebase.auth) {
                    enableSignupButton();
                } else {
                    handleInitializationFailure('Lỗi: Firebase khởi tạo thất bại sau thời gian chờ.');
                }
            }, 5000);
        });
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 min-h-screen flex items-center justify-center text-gray-200">
    <div class="max-w-md w-full space-y-8 p-6 bg-gray-800 rounded-xl shadow-lg">
        <div class="text-center">
            <h2 class="text-3xl font-extrabold text-gray-200">Đăng Ký</h2>
            <p class="mt-2 text-sm text-gray-400">Tạo tài khoản để sử dụng MyLock</p>
        </div>
        <div class="space-y-6">
            <div>
                <label for="email" class="sr-only">Email</label>
                <input id="email" type="email" required class="appearance-none relative block w-full px-3 py-2 border border-gray-600 placeholder-gray-400 text-gray-200 bg-gray-700 rounded-md focus:outline-none focus:ring-gray-500 focus:border-gray-500 sm:text-sm" placeholder="Email">
            </div>
            <div>
                <label for="password" class="sr-only">Mật khẩu</label>
                <input id="password" type="password" required class="appearance-none relative block w-full px-3 py-2 border border-gray-600 placeholder-gray-400 text-gray-200 bg-gray-700 rounded-md focus:outline-none focus:ring-gray-500 focus:border-gray-500 sm:text-sm" placeholder="Mật khẩu">
            </div>
            <div>
                <label for="confirm-password" class="sr-only">Xác nhận mật khẩu</label>
                <input id="confirm-password" type="password" required class="appearance-none relative block w-full px-3 py-2 border border-gray-600 placeholder-gray-400 text-gray-200 bg-gray-700 rounded-md focus:outline-none focus:ring-gray-500 focus:border-gray-500 sm:text-sm" placeholder="Xác nhận mật khẩu">
            </div>
            <div>
                <button onclick="signUp()" disabled class="w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-gray-900 bg-gray-200 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed">
                    Đăng Ký
                </button>
            </div>
            <p id="error-message" class="mt-2 text-sm text-red-400 hidden"></p>
            <div class="text-center">
                <p class="text-sm text-gray-400">Đã có tài khoản? <a href="signin.html" class="text-gray-200 hover:underline">Đăng nhập</a></p>
            </div>
        </div>
    </div>
</body>
</html>